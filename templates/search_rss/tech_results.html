{% extends "base.html" %}
{% load static %}

{% block title %}Tìm kiếm tin công nghệ{% endblock %}

{% block content %}
<form id="csrf-form">
    {% csrf_token %}
</form>
<div class="container mt-4">
    <h2 class="text-center mb-4">Kết quả tìm kiếm tin tức</h2>

    {% if query %}
        <div class="alert alert-info text-center">
            {% if results_count > 0 %}
                Tìm thấy <strong>{{ results_count }}</strong> kết quả cho "<strong>{{ query }}</strong>"
            {% else %}
                Không tìm thấy kết quả nào cho "<strong>{{ query }}</strong>"
            {% endif %}
        </div>
    {% endif %}

    {% for item in results %}
        <div class="card mb-4 shadow-sm">
            <div class="row g-0">
                <div class="col-md-4">
                    <img src="{{ item.image }}" alt="{{ item.title }}" class="img-fluid h-100 object-fit-cover rounded-start" style="max-height: 220px; object-fit: cover;">
                </div>
                <div class="col-md-8">
                    <div class="card-body d-flex flex-column justify-content-between h-100">
                        <div>
                            <h5 class="card-title">{{ item.title }}</h5>
                            <p class="card-text text-muted mb-1">
                                <small>{{ item.pub_date }} | <em>{{ item.source }}</em></small>
                            </p>
                            <p class="card-text">{{ item.description|truncatechars:200 }}</p>
                        </div>
                        <div class="mt-auto d-flex gap-2">
                            <a href="{{ item.link }}" target="_blank" class="btn btn-sm btn-primary">
                                Đọc bài viết
                            </a>
                            {% if user.is_authenticated %}
                            <button class="add-to-favorites btn btn-success btn-sm"
                                data-title="{{ item.title|escapejs }}"
                                data-link="{{ item.link }}"
                                data-image="{{ item.image }}"
                                data-description="{{ item.description|escapejs }}"
                                data-source="{{ item.source|escapejs }}"
                                data-pub_date="{{ item.pub_date|escapejs }}">
                                <i class="fas fa-heart"></i> Thêm vào yêu thích
                            </button>
                            {% else %}
                            <button class="btn btn-secondary btn-sm" onclick="window.location.href='{% url 'login' %}'">
                                <i class="fas fa-sign-in-alt"></i> Đăng nhập để thêm vào yêu thích
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
{% endblock %}
